<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>ðŸ“š Baca Dongeng Â· GitHub Explorer</title>
  <!-- Waline CSS (dari head) -->
  <link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
  <!-- Font & icon sederhana -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      transition: background-color 0.2s ease, border-color 0.2s;
    }

    /* variabel light (default) */
    body {
      --bg: #f8fafc;
      --surface: #ffffff;
      --text: #1e293b;
      --text-soft: #334155;
      --border: #e2e8f0;
      --accent: #2563eb;
      --accent-soft: #3b82f6;
      --header-bg: #ffffffdd;
      --card-shadow: 0 4px 12px rgba(0,0,0,0.03);
      --pagination-bg: #ffffff;
      --input-bg: #ffffff;
      --placeholder: #94a3b8;
      --waline-bg: #ffffff;
    }

    body.dark {
      --bg: #0f172a;
      --surface: #1e293b;
      --text: #e2e8f0;
      --text-soft: #cbd5e1;
      --border: #334155;
      --accent: #38bdf8;
      --accent-soft: #7dd3fc;
      --header-bg: #1e293be0;
      --card-shadow: 0 4px 12px rgba(0,0,0,0.5);
      --pagination-bg: #1e293b;
      --input-bg: #0f172a;
      --placeholder: #64748b;
      --waline-bg: #1e293b;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.5;
      padding: 0 0 2rem 0;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* header / toolbar */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      background: var(--surface);
      padding: 1rem 1.5rem;
      border-radius: 2rem;
      margin: 1.5rem 0 1.5rem 0;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--border);
      backdrop-filter: blur(4px);
    }

    .repo-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .repo-info i {
      color: var(--accent);
      font-size: 1.4rem;
    }

    .dark-toggle {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 2rem;
      padding: 0.4rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      color: var(--text);
      font-size: 0.9rem;
    }

    .search-wrapper {
      flex: 1 1 250px;
      display: flex;
      align-items: center;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 2rem;
      padding: 0.4rem 1rem;
      gap: 0.5rem;
    }

    .search-wrapper i {
      color: var(--text-soft);
    }

    .search-wrapper input {
      border: none;
      background: transparent;
      width: 100%;
      outline: none;
      color: var(--text);
    }

    .search-wrapper input::placeholder {
      color: var(--placeholder);
    }

    /* judul folder / buku */
    .book-header {
      margin: 2rem 0 0.5rem 0;
      display: flex;
      align-items: baseline;
      flex-wrap: wrap;
      gap: 0.75rem 1.5rem;
    }

    .book-title {
      font-size: 1.8rem;
      font-weight: 600;
      letter-spacing: -0.01em;
      background: linear-gradient(145deg, var(--accent), var(--accent-soft));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .chapter-count {
      font-size: 1rem;
      color: var(--text-soft);
      background: var(--surface);
      padding: 0.2rem 1rem;
      border-radius: 20px;
      border: 1px solid var(--border);
    }

    /* daftar bab (list chapters) â€” di bawah judul */
    .chapter-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin: 1rem 0 1.8rem 0;
      padding: 0.5rem 0;
      border-bottom: 2px solid var(--border);
      padding-bottom: 1rem;
    }

    .chapter-tab {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 0.5rem 1.2rem;
      border-radius: 30px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      color: var(--text-soft);
      transition: all 0.15s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.02);
      white-space: nowrap;
    }

    .chapter-tab:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .chapter-tab.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    /* konten pembaca */
    .reader-card {
      background: var(--surface);
      border-radius: 28px;
      padding: 2rem 1.8rem;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--border);
      margin: 1.5rem 0;
    }

    .chapter-title {
      font-size: 1.6rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      border-left: 6px solid var(--accent);
      padding-left: 1.2rem;
    }

    .chapter-content {
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 1.1rem;
      line-height: 1.7;
      color: var(--text);
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    /* highlight untuk pencarian */
    .search-highlight {
      background-color: #fde047;
      color: #1e293b;
      font-weight: 500;
      border-radius: 4px;
      padding: 0 2px;
    }
    body.dark .search-highlight {
      background-color: #b45309;
      color: #fffbeb;
    }

    /* pagination (di bawah) */
    .pagination-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.3rem 0.6rem;
      margin: 1.5rem 0 2rem 0;
      background: var(--pagination-bg);
      padding: 0.75rem 1rem;
      border-radius: 40px;
      border: 1px solid var(--border);
    }

    .page-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
      min-width: 2.5rem;
      height: 2.5rem;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.1s;
    }

    .page-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .page-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .nav-arrow {
      font-size: 1.2rem;
      padding: 0 0.6rem;
    }

    /* Waline comments â€” langsung di bawah pagination */
    .waline-wrapper {
      background: var(--waline-bg);
      border-radius: 28px;
      padding: 2rem 1.5rem;
      border: 1px solid var(--border);
      margin: 2rem 0;
    }

    /* penyesuaian waline agar mengikuti tema */
    :root.dark .waline-wrapper,
    body.dark .waline-wrapper {
      --waline-white: #1e293b;
      --waline-light-grey: #334155;
      --waline-dark-grey: #cbd5e1;
      --waline-color: #e2e8f0;
      --waline-bgcolor: #1e293b;
      --waline-bgcolor-light: #0f172a;
      --waline-border-color: #334155;
      --waline-disable-bgcolor: #1e293b;
    }

    /* loading */
    .loader {
      text-align: center;
      padding: 3rem;
      color: var(--text-soft);
    }

    .error-badge {
      background: #ef4444;
      color: white;
      padding: 0.75rem;
      border-radius: 40px;
      text-align: center;
    }

    footer {
      margin-top: 3rem;
      text-align: center;
      color: var(--text-soft);
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Toolbar: dark mode, search, repo info -->
    <div class="toolbar">
      <div class="repo-info">
        <i class="fa-brands fa-github"></i>
        <span>github-user/dongeng</span>
      </div>
      <div class="search-wrapper">
        <i class="fa-solid fa-search"></i>
        <input type="text" id="searchInput" placeholder="Cari kata dalam bab...">
      </div>
      <div class="dark-toggle" id="darkToggle">
        <i class="fa-regular fa-moon"></i>
        <span>Gelap</span>
      </div>
    </div>

    <!-- Judul buku / folder -->
    <div class="book-header">
      <span class="book-title" id="bookTitle">ðŸ“– Dongeng / Solo-Leveling</span>
      <span class="chapter-count" id="chapterCount">0 bab</span>
    </div>

    <!-- Daftar bab (letak di atas, di bawah judul) -->
    <div class="chapter-tabs" id="chapterTabs"></div>

    <!-- Pembaca konten -->
    <div class="reader-card" id="readerCard">
      <div class="chapter-title" id="currentChapterTitle">Pilih bab</div>
      <div class="chapter-content" id="chapterContent">ðŸ“‚ Memuat daftar file dari GitHub...</div>
    </div>

    <!-- Pagination (di bawah konten) -->
    <div class="pagination-bar" id="pagination"></div>

    <!-- WALINE: embed komentar (langsung di bawah) -->
    <div class="waline-wrapper">
      <div id="waline"></div>
    </div>

    <footer>
      <i class="fa-regular fa-clipboard"></i> klik kalimat â†’ salin link, tempel di komentar
    </footer>
  </div>

  <!-- Waline JS (dari body) -->
  <script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
    init({
      el: '#waline',
      serverURL: 'https://wl-c.vercel.app',
      lang: 'en',
    });
  </script>

  <!-- script utama -->
  <script type="module">
    // --- KONFIGURASI GitHub (ganti dengan repo punya anda) ---
    const GITHUB_OWNER = 'planet-99';          // GANTI: username github
    const GITHUB_REPO = 'quora';       // GANTI: nama repo
    const BASE_FOLDER = 'February';            // root folder dongeng (sesuai deskripsi)
    
    // state global
    let fileTree = [];                // daftar semua file mentah dari API
    let groupedChapters = {};          // { "Solo-Leveling": ["Solo-Leveling_Bab-01.txt", ...], "Overgeared": [...] }
    let bookNames = [];
    let activeBook = 'Solo-Leveling';  // default
    let currentPage = 1;
    let itemsPerPage = 12;             // jumlah bab per halaman (pagination)
    let currentFileContent = '';
    let searchTerm = '';

    // elemen DOM
    const bookTitleEl = document.getElementById('bookTitle');
    const chapterCountEl = document.getElementById('chapterCount');
    const chapterTabsEl = document.getElementById('chapterTabs');
    const currentChapterTitleEl = document.getElementById('currentChapterTitle');
    const chapterContentEl = document.getElementById('chapterContent');
    const paginationEl = document.getElementById('pagination');
    const searchInput = document.getElementById('searchInput');
    const darkToggle = document.getElementById('darkToggle');

    // --- inisialisasi dark mode ---
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
    }
    darkToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    });

    // --- 1. ambil daftar file dari API GitHub (REST) ---
    async function fetchFileList() {
      try {
        // API: GET /repos/{owner}/{repo}/contents/{path}
        const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${BASE_FOLDER}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Gagal mengambil daftar: ${res.status}`);
        const data = await res.json();
        
        // Filter hanya folder (type = dir)
        const folders = data.filter(item => item.type === 'dir');
        if (folders.length === 0) throw new Error('Tidak ada subfolder di dongeng/');

        // Ambil file .txt dari setiap folder secara paralel
        const promises = folders.map(async (folder) => {
          const folderName = folder.name;
          const folderUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${BASE_FOLDER}/${folderName}`;
          const folderRes = await fetch(folderUrl);
          if (!folderRes.ok) return [];
          const files = await folderRes.json();
          // filter file .txt
          const txtFiles = files.filter(f => f.name.endsWith('.txt')).map(f => ({
            name: f.name,
            path: f.path,
            download_url: f.download_url,
            folder: folderName
          }));
          return txtFiles;
        });

        const nestedFiles = await Promise.all(promises);
        fileTree = nestedFiles.flat();

        // group berdasarkan folder
        groupedChapters = {};
        fileTree.forEach(file => {
          if (!groupedChapters[file.folder]) groupedChapters[file.folder] = [];
          groupedChapters[file.folder].push(file);
        });

        // urutkan file per folder berdasarkan nama (bab)
        for (let book in groupedChapters) {
          groupedChapters[book].sort((a, b) => a.name.localeCompare(b.name, undefined, {numeric: true}));
        }

        bookNames = Object.keys(groupedChapters).sort();
        if (bookNames.length > 0) {
          activeBook = bookNames.includes('Solo-Leveling') ? 'Solo-Leveling' : bookNames[0];
        }
        renderChapterTabs();
        updateBookInfo();
        renderPagination();
        loadFirstChapterOfActiveBook();
      } catch (err) {
        console.error(err);
        chapterContentEl.innerText = 'âŒ Gagal memuat daftar dari GitHub. Cek owner/repo atau folder "dongeng".\n' + err.message;
      }
    }

    // render daftar bab (tab)
    function renderChapterTabs() {
      const files = groupedChapters[activeBook] || [];
      chapterTabsEl.innerHTML = '';
      files.forEach((file, index) => {
        const tab = document.createElement('span');
        tab.className = 'chapter-tab';
        // menampilkan nama tanpa folder dan ekstensi
        let displayName = file.name.replace(/\.txt$/, '').replace(/_/g, ' ');
        tab.textContent = displayName;
        tab.dataset.index = index;
        tab.dataset.path = file.path;
        tab.dataset.url = file.download_url;
        tab.addEventListener('click', () => {
          // hapus active dari semua
          document.querySelectorAll('.chapter-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          loadChapterContent(file);
        });
        chapterTabsEl.appendChild(tab);
      });
      // active first tab jika ada
      if (files.length > 0) {
        const firstTab = chapterTabsEl.querySelector('.chapter-tab');
        if (firstTab) firstTab.classList.add('active');
      }
    }

    // update info judul dan jumlah bab
    function updateBookInfo() {
      bookTitleEl.innerText = `ðŸ“– Dongeng / ${activeBook}`;
      const count = groupedChapters[activeBook]?.length || 0;
      chapterCountEl.innerText = `${count} bab`;
    }

    // load konten bab pertama dari active book (untuk inisialisasi)
    async function loadFirstChapterOfActiveBook() {
      const files = groupedChapters[activeBook] || [];
      if (files.length > 0) {
        await loadChapterContent(files[0]);
      } else {
        chapterContentEl.innerText = 'ðŸ“­ Belum ada file .txt di folder ini.';
      }
    }

    // memuat isi file dari raw URL
    async function loadChapterContent(file) {
      try {
        chapterContentEl.innerText = 'â³ memuat konten...';
        currentChapterTitleEl.innerText = file.name.replace(/\.txt$/, '').replace(/_/g, ' ');
        const res = await fetch(file.download_url);
        if (!res.ok) throw new Error('gagal ambil teks');
        let text = await res.text();
        currentFileContent = text;
        applySearchHighlight(text);
      } catch (e) {
        chapterContentEl.innerText = 'âŒ error: ' + e.message;
      }
    }

    // highlight pencarian + render
    function applySearchHighlight(content) {
      if (!searchTerm || searchTerm.trim() === '') {
        chapterContentEl.innerText = content;
        return;
      }
      const term = searchTerm.trim();
      const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      const parts = content.split(regex);
      const fragment = document.createElement('span');
      parts.forEach((part, i) => {
        if (part.toLowerCase() === term.toLowerCase()) {
          const mark = document.createElement('mark');
          mark.className = 'search-highlight';
          mark.textContent = part;
          fragment.appendChild(mark);
        } else {
          fragment.appendChild(document.createTextNode(part));
        }
      });
      chapterContentEl.innerHTML = ''; 
      chapterContentEl.appendChild(fragment);
    }

    // pagination berdasarkan bab yang tampil (bukan konten)
    function renderPagination() {
      const files = groupedChapters[activeBook] || [];
      const totalPages = Math.ceil(files.length / itemsPerPage) || 1;
      if (currentPage > totalPages) currentPage = totalPages;

      let pagHtml = '';
      // prev
      pagHtml += `<button class="page-btn nav-arrow" ${currentPage === 1 ? 'disabled' : ''} data-page="prev"><i class="fa-solid fa-chevron-left"></i></button>`;
      
      // angka
      for (let i = 1; i <= totalPages; i++) {
        pagHtml += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
      }

      // next
      pagHtml += `<button class="page-btn nav-arrow" ${currentPage === totalPages ? 'disabled' : ''} data-page="next"><i class="fa-solid fa-chevron-right"></i></button>`;

      paginationEl.innerHTML = pagHtml;

      // add listener
      paginationEl.querySelectorAll('.page-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          if (btn.disabled) return;
          const page = btn.dataset.page;
          if (page === 'prev') {
            if (currentPage > 1) currentPage--;
          } else if (page === 'next') {
            if (currentPage < totalPages) currentPage++;
          } else {
            currentPage = parseInt(page, 10);
          }
          renderPagination();
          // tampilkan tab yang sesuai: kita sorot chapter pertama di halaman itu
          const start = (currentPage - 1) * itemsPerPage;
          const paginatedFiles = files.slice(start, start + itemsPerPage);
          if (paginatedFiles.length > 0) {
            // cari tab sesuai file pertama (aktifkan)
            const targetFile = paginatedFiles[0];
            loadChapterContent(targetFile);
            // aktifkan tab yang cocok (setelah render tabs)
            setTimeout(() => {
              const tabs = document.querySelectorAll('.chapter-tab');
              tabs.forEach((tab, idx) => {
                const fileIdx = start + idx;
                if (fileIdx < files.length && files[fileIdx].name === targetFile.name) {
                  tab.classList.add('active');
                } else {
                  tab.classList.remove('active');
                }
              });
            }, 50);
          }
        });
      });
    }

    // saat search berubah
    searchInput.addEventListener('input', (e) => {
      searchTerm = e.target.value;
      if (currentFileContent) {
        applySearchHighlight(currentFileContent);
      }
    });

    // pindah buku (akan terpicu saat tab buku? kita tambah sederhana: klik judul sebenarnya tidak ada, tapi bisa kita extend)
    // supaya bisa ganti buku, kita tambah selector via bookTitle? lebih baik tambah dropdown sederhana.
    // tetapi sesuai permintaan, "list bab (letaknya di atas, di bawah nama folder/judul buku)" sudah terpenuhi.
    // tapi ganti buku belum ada. kita tambah dropdown mini untuk ganti buku.
    const headerDiv = document.querySelector('.book-header');
    const selectBook = document.createElement('select');
    selectBook.style.marginLeft = 'auto';
    selectBook.style.background = 'var(--surface)';
    selectBook.style.color = 'var(--text)';
    selectBook.style.border = '1px solid var(--border)';
    selectBook.style.padding = '0.4rem 1rem';
    selectBook.style.borderRadius = '30px';
    selectBook.innerHTML = '<option>Pilih seri</option>';
    headerDiv.appendChild(selectBook);

    // isi select setelah data terload
    function populateBookSelect() {
      selectBook.innerHTML = '';
      bookNames.forEach(book => {
        const opt = document.createElement('option');
        opt.value = book;
        opt.textContent = book;
        if (book === activeBook) opt.selected = true;
        selectBook.appendChild(opt);
      });
    }

    selectBook.addEventListener('change', (e) => {
      activeBook = e.target.value;
      currentPage = 1;
      updateBookInfo();
      renderChapterTabs();
      renderPagination();
      loadFirstChapterOfActiveBook();
    });

    // inisialisasi: jalankan fetch
    await fetchFileList();
    // setelah bookNames siap
    populateBookSelect();

    // fungsi tambahan: link sumber kata/kalimat disalin (sesuai deskripsi)
    // kita aktifkan klik pada chapterContent: jika user memilih teks, muncul notif dan copy link?
    // untuk sederhana: klik pada kata/kalimat akan menyalin teks + informasi bab ke clipboard sebagai "link"
    chapterContentEl.addEventListener('mouseup', () => {
      const selection = window.getSelection();
      const selectedText = selection.toString().trim();
      if (selectedText.length > 0) {
        const chapter = currentChapterTitleEl.innerText;
        const linkInfo = `[${chapter}] "${selectedText}" â€” sumber: GitHub/${GITHUB_OWNER}/${GITHUB_REPO}/${activeBook}`;
        navigator.clipboard.writeText(linkInfo).then(() => {
          // menampilkan pesan halus (tooltip)
          alert('ðŸ“‹ Link (kutipan) disalin! Tempel di kolom komentar.');
        }).catch(() => {});
      }
    });

    // perbaiki jika belum ada bab
    window.addEventListener('load', () => {
      // styling waline bisa diakali dengan observer jika perlu, namun biarkan default.
    });

  </script>
</body>
</html>
    
    
    
    